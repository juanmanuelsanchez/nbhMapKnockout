/*! nbhMapKnockout - version 1.0.0 */
!function(){var a={currentCity:null,cities:["Bilbao"],foursquareData:[],filteredPlaces:[],filteredNames:[],pinPosterLocations:[],markers:[],infoWindows:[]},b={setFoursquareData:function(b){a.foursquareData=b},getFoursquareData:function(){return a.foursquareData},setFilteredPlaces:function(b){a.filteredPlaces=b},getFilteredPlaces:function(){return a.filteredPlaces},setFilteredNames:function(b){a.filteredNames=b},getFilteredNames:function(){return a.filteredNames},setMarkers:function(b){a.markers.push(b)},getMarkers:function(){return a.markers},setInfoWindows:function(b){a.infoWindows.push(b)},getInfoWindows:function(){return a.infoWindows},setPinPosterLocations:function(b){a.pinPosterLocations.push(b)},getPinPosterLocations:function(){return a.pinPosterLocations}},c=function(a){function c(a){var c=a.geometry.location.lat(),d=a.geometry.location.lng(),f=a.name,g=(a.formatted_address,window.mapBounds),h=new google.maps.Marker({map:e,position:a.geometry.location,title:f});b.setMarkers(h);var i=new google.maps.InfoWindow({content:f});b.setInfoWindows(i),google.maps.event.addListener(h,"click",function(){i.open(e,h)}),g.extend(new google.maps.LatLng(c,d)),e.fitBounds(g),e.setCenter(g.getCenter())}function d(a,b){b==google.maps.places.PlacesServiceStatus.OK&&c(a[0])}function f(a){var b=new google.maps.places.PlacesService(e);for(place in a){var c={query:a[place]};b.textSearch(c,d)}}function g(a){var b=0,c=m.length;for(b;c>b;b++)m[b].setMap(a)}function h(){p.style.display="block",p.style.webkitAnimationName="fadeIn",p.style.webkitAnimationDuration="1s",n.style.display="none",n.style.webkitAnimationName="fadeOut",n.style.webkitAnimationDuration="1s",q.innerHTML="Foursquare recommended places(choose!):",r.value=" ",g(e)}function i(){g(null),"none"==n.style.display&&(n.style.display="inline",n.style.webkitAnimationName="fadeIn",n.style.webkitAnimationDuration="0.8s")}var j=this;j.name=ko.observable(a.name),j.address=ko.observable(a.address),j.city=ko.observable(a.city),j.country=ko.observable(a.country),j.location=ko.observable(a.location),j.rating=ko.observable(a.rating),j.listView=ko.pureComputed(function(){return j.name()+"    "+j.rating()}),b.setPinPosterLocations(j.location());var k=b.getPinPosterLocations(),l=[];l.push(j.location());var m=b.getMarkers(),n=(b.getInfoWindows(),document.getElementById("show")),o=document.getElementById("hide"),p=document.getElementById("places-list"),q=document.getElementById("foursquare-header"),r=document.getElementById("autocomplete");n.style.display="none",this.setCurrentPlace=function(a){var c=0,d=0,f=b.getMarkers(),g=b.getInfoWindows(),h=(f.length,g.length);for(c;h>c;d++,c++){var i=f[c],j=g[d];a.name()==j.content&&a.name()===i.title&&(null!=i.getAnimation()?(i.setAnimation(null),j.close(e,i)):(i.setAnimation(google.maps.Animation.BOUNCE),j.open(e,i)))}},$(r).devbridgeAutocomplete({lookup:k,minChars:1,onSearchComplete:function(a,b){p.style.display="none",p.style.webkitAnimationName="fadeOut",p.style.webkitAnimationDuration="1s",n.style.display="inline",n.style.webkitAnimationName="fadeIn",n.style.webkitAnimationDuration="1s";var c=[];for(suggestion in b){var d=b[suggestion].value;c.push(d)}i(),f(c)},onSelect:function(a){var b=[],c=a.value;b.push(c),i(),f(b),q.innerHTML="Foursquare recommended places(hide and/or populate with markers & click to choose!)"},showNoSuggestionNotice:!0,noSuggestionNotice:"Sorry, no matching results"}),n.addEventListener("click",function(){h()},!1),o.addEventListener("click",function(){i()},!1),window.mapBounds=new google.maps.LatLngBounds,f(l),window.addEventListener("resize",function(a){e.fitBounds(mapBounds)})},d={disableDefaultUI:!1},e=new google.maps.Map(document.getElementById("mapDiv"),d),f=function(){function d(a){return $.getJSON(i,function(b){var c=[];c=b.response.groups[0].items,a(c)}).error(function(a){f.text("Sorry, Foursquare articles could not be loaded")}),!1}var e=this;this.currentCity=ko.observableArray([]),this.currentCity=a.cities[0],console.log(e.currentCity);var f=$("#places-list");this.places=ko.observableArray([]);var g="WMGXUPU15HUVPMTMGK3WZPHVGBXKPXWMUQ5WW3DMRSOZUIH5",h="RFUOHDP441JSHFBS1AS0KLAGRVVRGNL2VACN0RHIJJNC5AT2",i="https://api.foursquare.com/v2/venues/explore?near="+e.currentCity+"&&client_id="+g+"&client_secret="+h+"&v=20130815&query=sushi";d(function(a){var d=a,f=0,g=0,h=0,i=d.length,j=[],k=[];for(f;i>f;f++){var l=d[f],m=l.venue.name;"Miu Japon√©s"!=m&&"Miu"!=m&&"Shibui Bilbo"!=m&&"Wok Chitau Nauo"!=m&&"Restaurante Xikelai Wok"!=m&&"SUMO Ledesma"!=m&&"SUMO"!=m&&j.push(l)}for(g;g<j.length;g++){var n=j[g],o=n.venue.name,p=n.venue.location.address,q=n.venue.location.city,r=n.venue.location.country,s=n.venue.rating,t={name:o,address:p,city:q,country:r,location:o+", "+p+", "+q+", "+r,rating:s};k.push(t)}for(h;h<k.length;h++){var u,v=k[h],w=v.name;"Kuma"===w?(u=w.replace("Kuma","KUMA"),v.name=u):"Mao Restaurante"===w?(u=w.replace("Mao Restaurante","Mao"),v.name=u):"SUMO Poza"===w?(u=w.replace("SUMO Poza","SUMO Pozas"),v.name=u):"Sakura"===w?(u=w.replace("Sakura","Restaurante Sakura"),v.name=u):"Wasabi Bilbao Restaurante Japones"===w&&(u=w.replace("Wasabi Bilbao Restaurante Japones","Restaurante Wasabi Bilbao"),v.name=u)}k.forEach(function(a){e.places.push(new c(a))}),b.setFoursquareData(d),b.setFilteredPlaces(j),b.setFilteredNames(k)})};ko.applyBindings(new f)}();